var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),Bg=function(t){function e(e,i){var s=t.call(this)||this;return s.init(e,i),s}return __extends(e,t),e.prototype.init=function(t,e){var i=new egret.Bitmap,s=RES.getRes("back_png");i.texture=s,this.addChild(i),i.width=t,i.height=e;var r=new egret.Sprite;r.graphics.beginFill(0,.6),r.graphics.drawRect(0,0,t,e),this.addChild(r)},e}(egret.DisplayObjectContainer);__reflect(Bg.prototype,"Bg");var Food=function(t){function e(){var e=t.call(this)||this;return e.init(),e.setFoodMap(),e}return __extends(e,t),e.prototype.setFoodMap=function(){var t=Math.ceil(23*Math.random()),e=Math.ceil(40*Math.random()+3);this.food.x=25*t,this.food.y=25*e;var i=[9408399,14329120,13639824,9301742,8190976,52480],s=Math.floor(Math.random()*i.length);this.food.graphics.beginFill(i[s],1),this.food.graphics.drawRect(0,0,20,20),this.food.graphics.endFill()},e.prototype.init=function(){this.food=new egret.Sprite,this.addChild(this.food)},e.prototype.getFoodXY=function(){var t=[this.food.x,this.food.y];return t},e}(egret.DisplayObjectContainer);__reflect(Food.prototype,"Food");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=t.call(this)||this;return e.stageW=0,e.stageH=0,e.score=0,e.speed=170,e.yinCount=1,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.createGameScene=function(){this.intoGameScene(),this.bgm=new Yinxiao,this.yinXiao()},e.prototype.intoGameScene=function(){var t=this.stage.stageWidth,e=this.stage.stageHeight;this.stageW=t,this.stageH=e,this.intoScene=new egret.DisplayObjectContainer,this.intoScene.name="into",this.addChild(this.intoScene);var i=new Bg(this.stageW,this.stageH);this.intoScene.addChild(i);var s=new egret.TextField;s.text="贪吃蛇",s.fontFamily="Kaiti",s.size=65,s.y=this.stageH/4,s.width=this.stageW,s.textAlign=egret.HorizontalAlign.CENTER,s.strokeColor=6073582,s.stroke=5,this.intoScene.addChild(s);var r=new egret.TextField;r.text="上、下、左、右\n\n滑动屏幕改变蛇的运动方向,\n\n吃到食物(小方块)加十分并且蛇生增长,\n\n蛇碰撞到屏幕边缘或者蛇头吃到蛇身,游戏结束",r.size=24,r.textColor=6591981,r.y=this.stageH/3,r.width=this.stageW,r.textAlign=egret.HorizontalAlign.CENTER,this.intoScene.addChild(r);var n=new egret.TextField;n.text="开始游戏",n.fontFamily="Kaiti",n.size=35,n.y=2*this.stageH/3,n.width=this.stageW,n.textAlign=egret.HorizontalAlign.CENTER,n.strokeColor=4443520,n.stroke=2,this.intoScene.addChild(n),n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startGameScene,this);var o=egret.Tween.get(n,{loop:!0});o.to({stroke:4,size:40},1e3).to({stroke:2,size:35},1e3)},e.prototype.startGameScene=function(){var t=RES.getRes("anniu_wav");t.play(0,1),this.getChildByName("into")&&(this.removeChild(this.intoScene),this.intoScene=null),this.initGameScene(),this.myTouch()},e.prototype.initGameScene=function(){this.bg=new Bg(this.stageW,this.stageH),this.addChild(this.bg),this.scoreText=new Score,this.addChild(this.scoreText),this.food=new Food,this.addChild(this.food),this.snaker=new Snake,this.addChild(this.snaker),this.timer=new egret.Timer(this.speed,0),this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.start(),this.removeChild(this.yin),this.yin=null,this.yinXiao()},e.prototype.timerFunc=function(){this.snaker.move(),this.snakerEatFood()},e.prototype.myTouch=function(){this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this)},e.prototype.touchBegin=function(t){this.beginX=t.stageX,this.beginY=t.stageY},e.prototype.touchEnd=function(t){this.endX=t.stageX,this.endY=t.stageY,this.gesture()},e.prototype.gesture=function(){Math.abs(this.endX-this.beginX)>Math.abs(this.endY-this.beginY)&&this.endX-this.beginX>0&&this.snaker.chageDir("right"),Math.abs(this.endX-this.beginX)>Math.abs(this.endY-this.beginY)&&this.endX-this.beginX<0&&this.snaker.chageDir("left"),Math.abs(this.endY-this.beginY)>Math.abs(this.endX-this.beginX)&&this.endY>this.beginY&&this.snaker.chageDir("down"),Math.abs(this.endY-this.beginY)>Math.abs(this.endX-this.beginX)&&this.endY<this.beginY&&this.snaker.chageDir("up")},e.prototype.snakerEatFood=function(){var t=this.food.getFoodXY(),e=[this.snaker.snakerArr[0][2].x,this.snaker.snakerArr[0][2].y];if(t[0]==e[0]&&t[1]==e[1]){var i=RES.getRes("chi_wav");i.play(0,1),this.score>=50&&this.score<=100?this.speed=125:this.score>=100&&this.score<=170?this.speed=100:this.score>=220&&(this.speed=70),this.timer.delay=this.speed,this.food.setFoodMap();var s=this.snaker.snakerArr[this.snaker.snakerArr.length-1][0],r=this.snaker.snakerArr[this.snaker.snakerArr.length-1][1];this.snaker.snakerArr.push([s,r,null]),this.score+=10,this.scoreText.setScore("score: "+this.score)}this.snakerIsDie()},e.prototype.snakerIsDie=function(){if(this.snaker.snakerArr[0][2].x<0||this.snaker.snakerArr[0][2].x>this.stageW||this.snaker.snakerArr[0][2].y<0||this.snaker.snakerArr[0][2].y>this.stageH){var t=RES.getRes("over_wav");t.play(0,1),this.gameVoerScene()}for(var e=0;e<this.snaker.snakerArr.length-1;e++)if(this.snaker.snakerArr[0][0]===this.snaker.snakerArr[e+1][0]&&this.snaker.snakerArr[0][1]===this.snaker.snakerArr[e+1][1]){this.gameVoerScene();var t=RES.getRes("over_wav");t.play(0,1)}},e.prototype.gameVoerScene=function(){this.timer.stop(),this.overScence=new egret.DisplayObjectContainer,this.addChild(this.overScence);var t=new egret.Sprite;t.graphics.beginFill(0,.8),t.graphics.drawRect(0,0,this.stageW,this.stageH),this.overScence.addChild(t);var e=new egret.TextField;e.text="本场游戏得分: "+this.score+"分",e.fontFamily="Kaiti",e.size=50,e.textColor=16711680,e.y=this.stageH/3,e.width=this.stageW,e.textAlign=egret.HorizontalAlign.CENTER,e.strokeColor=13639824,e.stroke=2,e.anchorOffsetX=this.stage.stageWidth/2,e.x=this.stage.stageWidth/2,e.anchorOffsetY=25,this.overScence.addChild(e);var i=new egret.TextField;i.text="重新开始",i.fontFamily="Kaiti",i.size=40,i.y=2*this.stageH/3,i.width=this.stageW,i.textAlign=egret.HorizontalAlign.CENTER,i.strokeColor=4443520,i.stroke=2,this.overScence.addChild(i),i.touchEnabled=!0,i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.reGame,this);var s=egret.Tween.get(e,{loop:!0});s.to({rotation:-15},1500).to({rotation:0},1500).to({rotation:15},1500).to({rotation:0},1500);var r=egret.Tween.get(i,{loop:!0});r.to({stroke:3,size:45},2e3).to({stroke:2,size:40},2e3),this.removeChild(this.yin),this.yin=null,this.yinXiao()},e.prototype.reGame=function(){var t=RES.getRes("anniu_wav");t.play(0,1),this.removeChild(this.bg),this.bg=null,this.removeChild(this.scoreText),this.scoreText=null,this.removeChild(this.food),this.food=null,this.removeChild(this.snaker),this.snaker=null,this.removeChild(this.overScence),this.overScence=null,this.score=0,this.speed=170,this.startGameScene()},e.prototype.yinXiao=function(){this.yin=new egret.TextField,this.yin.text="关闭BGM  ",this.yin.y=25,this.yin.width=this.stageW,this.yin.textAlign=egret.HorizontalAlign.RIGHT,this.yin.strokeColor=4443520,this.yin.stroke=2,this.yin.size=25,this.addChildAt(this.yin,1e3),this.yin.touchEnabled=!0,this.yin.addEventListener(egret.TouchEvent.TOUCH_TAP,this.stopSound,this)},e.prototype.stopSound=function(){this.yinCount%2!=0?(this.bgm.stopBGM(),this.yin.text="开启BGM  "):(this.bgm.playBMG(),this.yin.text="关闭BGM  "),this.yinCount++},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Score=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.setScore=function(t){this.scoreText.text=t},e.prototype.init=function(){this.scoreText=new egret.TextField,this.scoreText.text="score: 0",this.scoreText.x=25,this.scoreText.y=25,this.scoreText.size=30,this.scoreText.strokeColor=4443520,this.scoreText.stroke=2,this.addChild(this.scoreText)},e}(egret.DisplayObjectContainer);__reflect(Score.prototype,"Score");var Snake=function(t){function e(){var e=t.call(this)||this;return e.dir="right",e.snakerArr=[[5,3,null],[4,3,null],[3,3,null],[2,3,null]],e.init(),e}return __extends(e,t),e.prototype.chageDir=function(t){this.dir=t},e.prototype.init=function(){var t=this;this.snakerArr.forEach(function(e,i){null===t.snakerArr[i][2]&&(t.snakerArr[i][2]=new egret.Sprite),i==t.snakerArr.length-1?t.snakerArr[i][2].graphics.beginFill(65280,1):0==i?t.snakerArr[i][2].graphics.beginFill(16711680,1):t.snakerArr[i][2].graphics.beginFill(255,1),t.snakerArr[i][2].graphics.drawRect(0,0,20,20),t.snakerArr[i][2].graphics.endFill(),t.addChild(t.snakerArr[i][2]),t.snakerArr[i][2].x=25*e[0],t.snakerArr[i][2].y=25*e[1]})},e.prototype.move=function(){for(var t=this.snakerArr.length-1;t>0;t--)this.snakerArr[t][0]=this.snakerArr[t-1][0],this.snakerArr[t][1]=this.snakerArr[t-1][1];switch(this.dir){case"right":this.snakerArr[0][0]++;break;case"left":this.snakerArr[0][0]--;break;case"up":this.snakerArr[0][1]--;break;case"down":this.snakerArr[0][1]++}this.init()},e}(egret.DisplayObjectContainer);__reflect(Snake.prototype,"Snake");var Yinxiao=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.stopBGM=function(){this.soundChannel.stop()},e.prototype.playBMG=function(){this.soundChannel=this.sound.play(),this.soundChannel.volume=.4},e.prototype.init=function(){this.sound=RES.getRes("bgm_wav"),this.soundChannel=this.sound.play(),this.soundChannel.volume=.4},e}(egret.DisplayObjectContainer);__reflect(Yinxiao.prototype,"Yinxiao");